name: Desktop artifacts
permissions:
  contents: read

on: workflow_dispatch

env:
  BITRISEIO_ANDROID_KEYSTORE_ALIAS: ${{secrets.KEYSTORE_ALIAS}}
  BITRISEIO_ANDROID_KEYSTORE_PRIVATE_KEY_PASSWORD: ${{secrets.KEYSTORE_PRIVATE_KEY_PASSWORD}}
  BITRISEIO_ANDROID_KEYSTORE_URL: ${{secrets.KEYSTORE_FILE}}
  BITRISEIO_ANDROID_KEYSTORE_PASSWORD: ${{secrets.KEYSTORE_PASSWORD}}
  GEOAPIFY_API_KEY: ${{secrets.GEOAPIFY_API_KEY}}
  

jobs:
  build-deb:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up JDK 21
        uses: actions/setup-java@v5
        with:
          java-version: '21'
          distribution: 'liberica'
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4.4.2
        with:
          validate-wrappers: true
          cache-encryption-key: ${{ secrets.GRADLE_ENCRYPTION_KEY }}
      - name: Build installer
        run: ./gradlew desktop:packageReleaseDistributionForCurrentOS
      - name: Linux distributable
        uses: actions/upload-artifact@v4
        with:
          name: valiutchik-linux
          path: desktop/build/compose/binaries/main/deb/dev.fobo66.valiutchik.desktop_1.0.0_amd64.deb
        
  build-dmg:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up JDK 21
        uses: actions/setup-java@v5
        with:
          java-version: '21'
          distribution: 'liberica'
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4.4.2
        with:
          validate-wrappers: true
          cache-encryption-key: ${{ secrets.GRADLE_ENCRYPTION_KEY }}
      - name: Build installer
        run: ./gradlew desktop:packageReleaseDistributionForCurrentOS
      - name: macOS distributable
        uses: actions/upload-artifact@v4
        with:
          name: valiutchik-macos
          path: desktop/build/compose/binaries/main/dmg/dev.fobo66.valiutchik.desktop-1.0.0.dmg

  build-exe:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up JDK 21
        uses: actions/setup-java@v5
        with:
          java-version: '21'
          distribution: 'liberica'
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4.4.2
        with:
          validate-wrappers: true
          cache-encryption-key: ${{ secrets.GRADLE_ENCRYPTION_KEY }}
      - name: Build installer
        run: ./gradlew desktop:packageReleaseDistributionForCurrentOS
      - name: Windows distributable
        uses: actions/upload-artifact@v4
        with:
          name: valiutchik-windows
          path: desktop/build/compose/binaries/main/exe/dev.fobo66.valiutchik.desktop-1.0.0.exe
